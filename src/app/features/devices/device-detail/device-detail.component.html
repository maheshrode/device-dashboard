<div class="max-w-7xl mx-auto p-4 space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a
        routerLink="/devices"
        class="p-2 -ml-2 text-gray-400 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all duration-200"
        title="Back to Device List"
      >
        <lucide-icon [img]="ArrowLeft" class="w-6 h-6"></lucide-icon>
      </a>
      <div>
        <h2 class="text-3xl font-bold text-gray-900">Device Monitor</h2>
        <p class="text-gray-500">Device ID: {{ deviceId }}</p>
      </div>
    </div>
    <div
      *ngIf="latestEvent$ | async as event"
      @fadeAnimation
      class="flex items-center gap-2 px-4 py-2 rounded-full font-semibold capitalize transition-colors duration-300"
      [class]="getStatusStyle(event.status)"
    >
      <lucide-icon
        [img]="getStatusIcon(event.status)"
        class="w-5 h-5"
      ></lucide-icon>
      {{ event.status }}
    </div>
  </div>

  <!-- Real-time Dashboard Grid -->
  <div
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
    *ngIf="latestEvent$ | async as event; else loading"
  >
    <!-- Parts Per Minute -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
      <div class="flex items-center justify-between mb-2">
        <span class="text-gray-500 font-medium">Performance</span>
        <lucide-icon
          [img]="Activity"
          class="w-5 h-5 text-blue-500"
        ></lucide-icon>
      </div>
      <div class="text-3xl font-bold text-gray-900">
        {{ event.partsPerMinute | number : "1.0-2" }}
      </div>
      <div class="text-xs text-gray-400 mt-1">Parts Per Minute</div>
    </div>

    <!-- Order ID -->
    <div
      class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:shadow-md transition-shadow group relative"
      (click)="openOrderDetails(event.order)"
    >
      <div
        class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity"
      >
        <lucide-icon
          [img]="Server"
          class="w-4 h-4 text-purple-300"
        ></lucide-icon>
      </div>
      <div class="flex items-center justify-between mb-2">
        <span class="text-gray-500 font-medium">Current Order</span>
        <lucide-icon
          [img]="Server"
          class="w-5 h-5 text-purple-500"
        ></lucide-icon>
      </div>
      <div
        class="text-3xl font-bold text-gray-900 group-hover:text-purple-600 transition-colors"
      >
        #{{ event.order }}
      </div>
      <div class="text-xs text-gray-400 mt-1">
        Active Job - Click for details
      </div>
    </div>

    <!-- Last Update (Timestamp) -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
      <div class="flex items-center justify-between mb-2">
        <span class="text-gray-500 font-medium">Last Signal</span>
        <lucide-icon
          [img]="Clock"
          class="w-5 h-5 text-orange-500"
        ></lucide-icon>
      </div>
      <div class="text-lg font-bold text-gray-900">
        {{ event.timestamp | date : "mediumTime" }}
      </div>
      <div class="text-xs text-gray-400 mt-1">
        {{ event.timestamp | date : "mediumDate" }}
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div
    class="grid grid-cols-1 lg:grid-cols-2 gap-6"
    *ngIf="latestEvent$ | async"
  >
    <app-performance-chart [data]="eventHistory"></app-performance-chart>
    <app-status-timeline [data]="eventHistory"></app-status-timeline>
  </div>

  <ng-template #loading>
    <div class="p-12 text-center text-gray-500 animate-pulse">
      Connecting to device stream...
    </div>
  </ng-template>

  <app-order-detail
    [isOpen]="isOrderModalOpen"
    [order]="selectedOrder"
    (closeEvent)="closeOrderModal()"
  ></app-order-detail>
</div>
